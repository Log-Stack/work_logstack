{% extends 'base.html' %}

{% load static %}

{% block content %}


<script>

var selected_date = {{selected_date}}

var total_time = null;

var date = null;

var working_time = null;
var start_time = null;
var end_time = null;



function setFormDate(){
var week = ['일', '월', '화', '수', '목', '금', '토'];
var d = new Date(document.getElementById('week_start_date').value);
    for(let i = 0; i<7;i++){
        date[i].innerText = (d.getMonth() + 1) + "." + d.getDate() + " (" + week[d.getDay()] + ")";
        d.setDate(d.getDate() + 1);
    }
}

function setDateInit(){
var d = new Date(Date.now());
d.setDate(d.getDate() - d.getDay() + 7);
result_str = d.getFullYear() + "-" +("0" +  (d.getMonth() + 1)).slice(-2) + "-" + ("0" + d.getDate()).slice(-2);
document.getElementById('week_start_date').value = result_str;

}

function setDateBefore(){
var d = new Date(document.getElementById('week_start_date').value);
d.setDate(d.getDate() - 7);
if (d <= Date.now()){
alert("이번주 이전 날자는 신청이 불가능 합니다.");
return;
}
result_str = d.getFullYear() + "-" +("0" +  (d.getMonth() + 1)).slice(-2) + "-" + ("0" + d.getDate()).slice(-2);
document.getElementById('week_start_date').value = result_str;

setFormDate()
}

function setDateAfter(){
var d = new Date(document.getElementById('week_start_date').value);
d.setDate(d.getDate() + 7);
result_str = d.getFullYear() + "-" +("0" +  (d.getMonth() + 1)).slice(-2) + "-" + ("0" + d.getDate()).slice(-2);
document.getElementById('week_start_date').value = result_str;

setFormDate()
}


function getAllWorkTimes(){

total_time = document.getElementsByClassName("sum_time")[0];

date = document.getElementsByClassName("date");

working_time = document.getElementsByClassName("work_time");
start_time = document.getElementsByClassName("start_time");
end_time = document.getElementsByClassName("end_time");
}

function diff(start, end) {
    start = start.split(":");
    end = end.split(":");
    var startDate = new Date(0, 0, 0, start[0], start[1], 0);
    var endDate = new Date(0, 0, 0, end[0], end[1], 0);
    var diff = endDate.getTime() - startDate.getTime();
    var hours = Math.floor(diff / 1000 / 60 / 60);
    diff -= hours * 1000 * 60 * 60;
    var minutes = Math.floor(diff / 1000 / 60);

    // If using time pickers with 24 hours format, add the below line get exact hours
    if (hours < 0)
       hours = hours + 24;

    return (hours <= 9 ? "0" : "") + hours + ":" + (minutes <= 9 ? "0" : "") + minutes;
}

function sumAll(){
    var result = "";
    var sum_hour = 0;
    var sum_minute = 0;

    for (let i = 0; i < start_time.length; i++) {
        var time = working_time[i].innerText;
        sum_hour += time.split(":")[0] *  1;
        sum_minute += time.split(":")[1] * 1;

    }
    sum_hour += Math.floor(sum_minute / 60);
    sum_minute = sum_minute % 60;

    result =  ("0" +  sum_hour).slice(-2) + ":" + ("0" + sum_minute).slice(-2);


    total_time.innerText = result;
}

function CalculateAllWorkTime(){
    for (let i = 0; i < start_time.length; i++) {
        if(start_time[i].value == "" ||  end_time[i].value == ""){
            working_time[i].innerText = '00:00';
        }
        else{
        working_time[i].innerText = diff(start_time[i].value, end_time[i].value);
        }
    }
    sumAll();
}

function addAllEvents(){
    for (let i = 0; i < start_time.length; i++) {
        start_time[i].addEventListener('change', CalculateAllWorkTime);
        end_time[i].addEventListener('change', CalculateAllWorkTime);
    }
}
function init(){
    setDateInit();
    getAllWorkTimes();
    addAllEvents();

    setFormDate()
}


window.addEventListener('DOMContentLoaded', init);









</script>
<div class="container">
    <br>
    <div class="hero is-primary is-small">
        <div class="hero-body">
            <p class="title">
                Register Schedule
            </p>
        </div>
    </div>
    <br>
<form method="post" action="" role="form">
    {% csrf_token %}

    <div class="columns is-centered">
        <div class="column">
<!--            <div class="columns is-centered">-->
<!--                <div class="column is-6">-->
                    <div class="box has-text-centered">
                        <h3 class="title is-3">총 예정 근무 </h3>
                        <h1 class="title is-1"><p class="sum_time">00:00</p></h1>
                    </div>
<!--                </div>-->
<!--            </div>-->
        </div>
    </div>

    <div class="columns is-centered">
        <div class="column">

<!--            <div class="columns is-centered">-->
<!--                <div class="column">-->
<!--                    <div class="box">-->
<!--                        <div class="buttons has-addons" style="margin-left: 37%">-->
<!--                            <p class="button" onclick="setDateBefore()">-->
<!--                            <span class="material-icons">-->
<!--                                arrow_back-->
<!--                            </span>-->
<!--                            </p>-->
<!--                            <p class="button">-->
<!--                                {{ forms.week_start_date }}-->
<!--                            </p>-->
<!--                            <p class="button" onclick="setDateAfter()">-->
<!--                            <span class="material-icons">-->
<!--                                arrow_forward-->
<!--                            </span>-->
<!--                            </p>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
            <div class="box">
                <div class="columns">

                    <div class="column is-5" style="display: flex;">
<!--                        <div class="box">-->
                            <div class="buttons has-addons">
                                <p class="button" onclick="setDateBefore()">
                                <span class="material-icons">
                                    arrow_back
                                </span>
                                </p>
                                <p class="button">
                                    {{ forms.week_start_date }}
                                </p>
                                <p class="button" onclick="setDateAfter()">
                                <span class="material-icons">
                                    arrow_forward
                                </span>
                                </p>
                            </div>
<!--                        </div>-->
                    </div>


                    <div class="column" style="position: relative;">
                        <b class="title is-3" style="padding-left: 30px; position: absolute; top: 25%;">이번 주 근무</b>
                    </div>

                    <div class="column is-2">
                        <button type="submit" class="button is-primary is-large" style="margin-left: 100px">신청</button>
                    </div>

                </div>
            </div>
            <div class="box">
                <div class="columns is-centered">
                    <div class="column is-2">
                        <p class='title is-5 date'>3.21(일)</p>
                    </div>
                    <div class="column is-7">
                        <div class="columns is-centered">

                            <div class="column is-3">
                                <div class="select is-success">
                                    {{ forms.sun_work_type }}
                                </div>
                            </div>
                            <div class="column is-3">
                                {{ forms.sun_start }}
                            </div>
                            <div class="column is-1">
                                -
                            </div>
                            <div class="column is-3">
                                {{ forms.sun_end }}
                            </div>
                        </div>
                    </div>
                    <div class="column is-3">

                        <div class="columns is-centered">
                            <div class="column">
                                <span class="tag is-primary is-medium"><p>예정 근무 시간</p><p
                                        class="work_time">00:00</p></span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="box">
                <div class="columns is-centered">
                    <div class="column is-2">
                        <p class='title is-5 date'>3.21(일)</p>
                    </div>
                    <div class="column is-7">
                        <div class="columns is-centered">

                            <div class="column is-3">
                                <div class="select is-success">
                                    {{ forms.mon_work_type }}
                                </div>
                            </div>
                            <div class="column is-3">
                                {{ forms.mon_start }}
                            </div>
                            <div class="column is-1">
                                -
                            </div>
                            <div class="column is-3">
                                {{ forms.mon_end }}
                            </div>
                        </div>
                    </div>
                    <div class="column is-3">

                        <div class="columns is-centered">
                            <div class="column">
                                <span class="tag is-primary is-medium"><p>예정 근무 시간</p><p
                                        class="work_time">00:00</p></span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="box">
                <div class="columns is-centered">
                    <div class="column is-2">
                        <p class='title is-5 date'>3.21(일)</p>
                    </div>
                    <div class="column is-7">
                        <div class="columns is-centered">

                            <div class="column is-3">
                                <div class="select is-success">
                                    {{ forms.tue_work_type }}
                                </div>
                            </div>
                            <div class="column is-3">
                                {{ forms.tue_start }}
                            </div>
                            <div class="column is-1">
                                -
                            </div>
                            <div class="column is-3">
                                {{ forms.tue_end }}
                            </div>
                        </div>
                    </div>
                    <div class="column is-3">

                        <div class="columns is-centered">
                            <div class="column">
                                <span class="tag is-primary is-medium"><p>예정 근무 시간</p><p
                                        class="work_time">00:00</p></span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="box">
                <div class="columns is-centered">
                    <div class="column is-2">
                        <p class='title is-5 date'>3.21(일)</p>
                    </div>
                    <div class="column is-7">
                        <div class="columns is-centered">

                            <div class="column is-3">
                                <div class="select is-success">
                                    {{ forms.wed_work_type }}
                                </div>
                            </div>
                            <div class="column is-3">
                                {{ forms.wed_start }}
                            </div>
                            <div class="column is-1">
                                -
                            </div>
                            <div class="column is-3">
                                {{ forms.wed_end }}
                            </div>
                        </div>
                    </div>
                    <div class="column is-3">

                        <div class="columns is-centered">
                            <div class="column">
                                <span class="tag is-primary is-medium"><p>예정 근무 시간</p><p
                                        class="work_time">00:00</p></span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="box">
                <div class="columns is-centered">
                    <div class="column is-2">
                        <p class='title is-5 date'>3.21(일)</p>
                    </div>
                    <div class="column is-7">
                        <div class="columns is-centered">

                            <div class="column is-3">
                                <div class="select is-success">
                                    {{ forms.thu_work_type }}
                                </div>
                            </div>
                            <div class="column is-3">
                                {{ forms.thu_start }}
                            </div>
                            <div class="column is-1">
                                -
                            </div>
                            <div class="column is-3">
                                {{ forms.thu_end }}
                            </div>
                        </div>
                    </div>
                    <div class="column is-3">

                        <div class="columns is-centered">
                            <div class="column">
                                <span class="tag is-primary is-medium"><p>예정 근무 시간</p><p
                                        class="work_time">00:00</p></span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="box">
                <div class="columns is-centered">
                    <div class="column is-2">
                        <p class='title is-5 date'>3.21(일)</p>
                    </div>
                    <div class="column is-7">
                        <div class="columns is-centered">

                            <div class="column is-3">
                                <div class="select is-success">
                                    {{ forms.fri_work_type }}
                                </div>
                            </div>
                            <div class="column is-3">
                                {{ forms.fri_start }}
                            </div>
                            <div class="column is-1">
                                -
                            </div>
                            <div class="column is-3">
                                {{ forms.fri_end }}
                            </div>
                        </div>
                    </div>
                    <div class="column is-3">

                        <div class="columns is-centered">
                            <div class="column">
                                <span class="tag is-primary is-medium"><p>예정 근무 시간</p><p
                                        class="work_time">00:00</p></span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="box">
                <div class="columns is-centered">
                    <div class="column is-2">
                        <p class='title is-5 date'>3.21(일)</p>
                    </div>
                    <div class="column is-7">
                        <div class="columns is-centered">

                            <div class="column is-3">
                                <div class="select is-success">
                                    {{ forms.sat_work_type }}
                                </div>
                            </div>
                            <div class="column is-3">
                                {{ forms.sat_start }}
                            </div>
                            <div class="column is-1">
                                -
                            </div>
                            <div class="column is-3">
                                {{ forms.sat_end }}
                            </div>
                        </div>
                    </div>
                    <div class="column is-3">

                        <div class="columns is-centered">
                            <div class="column">
                                <span class="tag is-primary is-medium"><p>예정 근무 시간</p><p
                                        class="work_time">00:00</p></span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

</form>

</div>

{% endblock %}